<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Edit toestel</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
</head>
<body>
<h1>Detailpagina</h1>
<div class="container">
    <h2>Details van toestel <span class="naamToestel"></span></h2>
    <form id="edit-form" onsubmit="edit()" class="w-50">
        <label for="naam">Naam:</label><br>
        <input type="text" id="naam" name="naam" class="form-control" placeholder="Toestelnaam"><br>
        <label for="aankoopdatum">AankoopDatum:</label><br>
        <input type="date" class="form-control" id="aankoopdatum" name="aankoopdatum"><br>
        <label for="prijs">Prijs:</label><br>
        <input type="number"  class="form-control" step="any" id="prijs" name="prijs"><br><br>
        <input type="submit" class="btn btn-primary" value="Update">
    </form>
</div>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
<script>
    console.log(window.location.href);
    let url = window.location.href.toString();
    let id = url.replace("http://localhost:8080/besteldtoestel/DetailBesteldToestel/", "");
    id = id.replace(".html", "");
    $(function () {
        $.getJSON('http://localhost:8080/besteldtoestel/besteldtoesteldetails/' + id, function (data) {
            $('.naamToestel').html(data.naam);
            $('#naam').val(data.naam);
            $('#aankoopdatum').val(data.aankoopdatum);
            $('#prijs').val(data.prijs);

            console.log(data);
        });
    })

    function edit() {
        let toestelId = parseInt(id)
        let naam = $("#naam").val().toString();
        let aankoopdatum = new Date($("#aankoopdatum").val()).getTime();
        let prijs = parseFloat($("#prijs").val());

        $.ajax({
            type: 'PUT',
            url: 'http://localhost:8080/besteldtoestel/updatebesteldtoestel',
            //contentType: 'application/json',
            data: {
                id: toestelId,
                aankoopdatumMillis: aankoopdatum,
                naam: naam,
                prijs: prijs
            },
            success: function (result) {
                window.location.href = "http://localhost:8080/besteldtoestel/OverviewBesteldeToestellen.html";
                console.log('SUCCESS');
            },
            error: function (jqXhr, textStatus, errorMessag) {
                console.log('ERROR');
            }
        });
    }
</script>
</body>
</html>